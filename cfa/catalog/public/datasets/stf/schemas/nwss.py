import random
import pandas as pd 
import polars as pl 
import pandera.pandas as pa 
from faker import Faker

fake = Faker()

wwtop_opts = ['ak', 'al', 'az', 'ca', 'ar', 'co', 'ct', 'dc', 'fl', 'ga', 'gu',
       'hi', 'ia', 'id', 'il', 'in', 'ks', 'ky', 'la', 'ma', 'md', 'me',
       'mn', 'mo', 'ms', 'mt', 'nc', 'nd', 'ne', 'nh', 'nj', 'nm', 'nv',
       'ny', 'oh', 'ok', 'or', 'pa', 'ri', 'sc', 'sd', 'tn', 'tx', 'ut',
       'va', 'vt', 'wa', 'wi', 'wy', 'de', 'mi', 'wv']
reporting_jur_opts = ['ak', 'al', 'az', 'ca', 'ar', 'lc', 'co', 'ct', 'dc', 'fl', 'ga',
       'gu', 'hi', 'ia', 'id', 'il', 'ci', 'in', 'ks', 'ky', 'la', 'ma',
       'md', 'me', 'mn', 'mo', 'ms', 'mt', 'nc', 'nd', 'ne', 'nh', 'nj',
       'nm', 'nv', 'nz', 'ny', 'oh', 'ok', 'or', 'pa', 'ri', 'sc', 'sd',
       'tn', 'tx', 'ut', 'va', 'vt', 'wa', 'wi', 'wy', 'de', 'mi', 'ph',
       'ho', 'wv']
matrix_opts = ['post grit removal', 'raw wastewater', 'primary sludge',
       'primary effluent', 'holding tank', 'secondary effluent']
sample_location_opts = ['wwtp', 'upstream']
trend_flowpop_opts = ['plateau', 'increase', 'decrease', 'sustained increase', 'sustained decrease', 'no clear trend']

load_schema = pa.DataFrameSchema(
    {
        "sample_id": pa.Column(str),
        "lab_id": pa.Column(str, nullable = True),
        "key_plot": pa.Column(str),
        "day_num": pa.Column(int, coerce = True),
        "cases_new_cens_per100k": pa.Column(float, nullable = True),
        "pcr_target_flowpop_lin": pa.Column(float, nullable = True),
        "sample_collect_date": pa.Column(str, pa.Check(lambda x: pd.to_datetime(x, errors='coerce').notna()), coerce = True),
        "pcr_target_flowpop_log10": pa.Column(float, nullable = True),
        "rec_eff_percent": pa.Column(float, nullable = True),
        "wwtp_id": pa.Column(int, nullable = True, coerce = True),
        "wwtp_jurisdiction": pa.Column(str, pa.Check.isin(wwtop_opts), nullable = True),
        "county_names": pa.Column(str, nullable = True),
        "stormwater_input": pa.Column(str, pa.Check.isin(['yes', 'no']), nullable = True),
        "influent_equilibrated": pa.Column(str, pa.Check.isin(['yes', 'no', '0']), nullable = True),
        "sample_type": pa.Column(str, nullable = True),
        "sample_matrix": pa.Column(str, pa.Check.isin(matrix_opts), nullable = True),
        "sample_location": pa.Column(str, pa.Check.isin(sample_location_opts), nullable = True),
        "sample_location_specify": pa.Column(object, nullable = True, coerce = True),
        "reporting_jurisdiction": pa.Column(str, pa.Check.isin(reporting_jur_opts),  nullable = True),
        "capacity_mgd": pa.Column(float, nullable = True),
        "population_served": pa.Column(str, pa.Check.isin(['yes', 'no']), nullable = True, coerce = True),
        "industrial_input": pa.Column(float, nullable = True),
        "sewage_travel_time": pa.Column(float, nullable = True),
        "slopes_flowpop_5m": pa.Column(float, nullable = True),
        "pvals_flowpop_5m": pa.Column(float, nullable = True),
        "pdc_flowpop_5m": pa.Column(float, nullable = True),
        "predsuprexc_flowpop_5m": pa.Column(float, nullable = True),
        "alert_flowpop_5m": pa.Column(float, nullable = True),
        "slopes_flowpop_3m": pa.Column(float, nullable = True),
        "pvals_flowpop_3m": pa.Column(float, nullable = True),
        "pdc_flowpop_3m": pa.Column(float, nullable = True),
        "predsuprexc_flowpop_3m": pa.Column(float, nullable = True),
        "alert_flowpop_3m": pa.Column(float, nullable = True),
        "trend_flowpop_5m3m_p05": pa.Column(float, nullable = True),
        "trend_flowpop_5m3m_p05_prev": pa.Column(float, nullable = True),
        "slopes_mic_5m": pa.Column(float, nullable = True),
        "pvals_mic_5m": pa.Column(float, nullable = True),
        "pdc_mic_5m": pa.Column(float, nullable = True),
        "predsuprexc_mic_5m": pa.Column(float, nullable = True),
        "alert_mic_3m": pa.Column(float, nullable = True),
        "trend_mic_5m3m_p05": pa.Column(float, nullable = True),
        "trend_mic_5m3m_p05_prev": pa.Column(float, nullable = True),
        "slopes_flowpop_15d": pa.Column(float, nullable = True),
        "pvals_flowpop_15d": pa.Column(float, nullable = True),
        "pdc_flowpop_15d": pa.Column(float, nullable = True),
        "predsuprexc_flowpop_15d": pa.Column(float, nullable = True),
        "alert_flowpop_15d": pa.Column(float, nullable = True),
        "slopes_flowpop_8d": pa.Column(float, nullable = True),
        "pvals_flowpop_8d": pa.Column(float, nullable = True),
        "pdc_flowpop_8d": pa.Column(float, nullable = True),
        "predsuprexc_flowpop_8d": pa.Column(float, nullable = True),
        "alert_flowpop_8d": pa.Column(float, nullable = True),
        "trend_flowpop_15d8d_p05": pa.Column(float, nullable = True),
        "trend_flowpop_15d8d_p05_prev": pa.Column(float, nullable = True),
        "slopes_mic_15d": pa.Column(float, nullable = True),
        "pvals_mic_15d": pa.Column(float, nullable = True),
        "pdc_mic_15d": pa.Column(float, nullable = True),
        "predsuprexc_mic_15d": pa.Column(float, nullable = True),
        "alert_mic_15d": pa.Column(float, nullable = True),
        "slopes_mic_8d": pa.Column(float, nullable = True),
        "pvals_mic_8d": pa.Column(float, nullable = True),
        "pdc_mic_8d": pa.Column(float, nullable = True),
        "predsuprexc_mic_8d": pa.Column(float, nullable = True),
        "alert_mic_8d": pa.Column(float, nullable = True),
        "trend_mic_15d8d_p05": pa.Column(float, nullable = True),
        "trend_mic_15d8d_p05_prev": pa.Column(float, nullable = True),
        "cases_new_cens": pa.Column(float, nullable = True),
        "pcr_target_mic_lin_roll7": pa.Column(float, nullable = True),
        "pcr_target_flowpop_lin_roll7": pa.Column(float, nullable = True),
        "pcr_target_flowpop_lin_spline": pa.Column(float, nullable = True),
        "pcr_target_mic_lin_spline": pa.Column(float, nullable = True),
        "cases_new_cens_per100k_spline": pa.Column(float, nullable = True),
        "pcr_target_detect": pa.Column(float, nullable = True),
        "hum_frac_mic_conc": pa.Column(float, nullable = True),
        "hum_frac_mic_unit": pa.Column(float, nullable = True),
        "hum_frac_chem_conc": pa.Column(float, nullable = True),
        "hum_frac_chem_unit": pa.Column(float, nullable = True),
        "other_norm_conc": pa.Column(float, nullable = True),
        "other_norm_unit": pa.Column(float, nullable = True),
        "lod_sewage": pa.Column(float, nullable = True),
        "pcr_target": pa.Column(float, nullable = True),
        "pcr_gene_target_agg": pa.Column(float, nullable = True),
        "inhibition_detect": pa.Column(float, nullable = True),
        "inhibition_adjust": pa.Column(float, nullable = True),
        "hum_frac_target_chem": pa.Column(float, nullable = True),
        "other_norm_name": pa.Column(float, nullable = True),
        "hum_frac_target_mic": pa.Column(float, nullable = True),
        "flow_rate": pa.Column(float, nullable = True),
        "pcr_target_avg_conc": pa.Column(float, nullable = True),
        "pcr_target_below_lod": pa.Column(float, nullable = True),
        "solids_separation": pa.Column(float, nullable = True),
        "concentration_method": pa.Column(float, nullable = True),
        "extraction_method": pa.Column(float, nullable = True),
        "rec_eff_target_name": pa.Column(float, nullable = True),
        "rec_eff_spike_matrix": pa.Column(float, nullable = True),
        "pasteurized": pa.Column(float, nullable = True),
        "pcr_type": pa.Column(float, nullable = True),
        "quant_stan_type": pa.Column(float, nullable = True),
        "pcr_target_units": pa.Column(float, nullable = True),
        "quality_flag": pa.Column(float, nullable = True),
        "collection_storage_temp": pa.Column(float, nullable = True),
        "collection_storage_time": pa.Column(float, nullable = True),
        "pre_conc_storage_temp": pa.Column(float, nullable = True), 
        "pre_conc_storage_time": pa.Column(float, nullable = True),
        "pre_ext_storage_temp": pa.Column(float, nullable = True),
        "pre_ext_storage_time": pa.Column(float, nullable = True),
        "sample_collect_time": pa.Column(float, nullable = True),
        "time_zone": pa.Column(float, nullable = True),
        "collection_water_temp": pa.Column(float, nullable = True),
        "tot_conc_vol": pa.Column(float, nullable = True),
        "ext_blank": pa.Column(float, nullable = True),
        "num_no_target_control": pa.Column(float, nullable = True),
        "tss": pa.Column(float, nullable = True),
        "ph": pa.Column(float, nullable = True),
        "composite_freq": pa.Column(float, nullable = True),
        "pcr_target_avg_conc_log10": pa.Column(float, nullable = True),
        "pcr_target_avg_conc_lin": pa.Column(float, nullable = True),
        "pcr_target_mic_lin": pa.Column(float, nullable = True),
        "pcr_target_mic_log10": pa.Column(float, nullable = True),
        "rec_eff_spike_conc": pa.Column(float, nullable = True),
        "conductivity": pa.Column(float, nullable = True),
        "equiv_sewage_amt": pa.Column(float, nullable = True),
        "hum_frac_mic_conc_lin": pa.Column(float, nullable = True),
        "ntc_amplify": pa.Column(float, nullable = True),
        "ptc_flowpop_3m": pa.Column(float, nullable = True),
        "ptc_flowpop_5m": pa.Column(float, nullable = True),
        "ptc_flowpop_8d": pa.Column(float, nullable = True),
        "ptc_flowpop_15d": pa.Column(float, nullable = True),
        "ptc_mic_3m": pa.Column(float, nullable = True),
        "ptc_mic_5m": pa.Column(float, nullable = True),
        "ptc_mic_8d": pa.Column(float, nullable = True),
        "ptc_mic_15d": pa.Column(float, nullable = True),
        "perc_flowpop": pa.Column(float, nullable = True),
        "quin_flowpop_bin": pa.Column(float, nullable = True),
        "perc_mic": pa.Column(float, nullable = True),
        "quin_mic_bin": pa.Column(float, nullable = True),
        "major_lab_method": pa.Column(float, nullable = True),
        "site_id": pa.Column(float, nullable = True),
        "jurisdiction_policy_rid": pa.Column(float, nullable = True)
    }
)

sample_type_opts = ['24-hr flow-weighted composite', 'grab',
       '24-hr time-weighted composite', '1-hr time-weighted composite',
       '2-hr manual composite', '24-hr manual composite',
       '22-hr time-weighted composite', '26-hr time-weighted composite']

def load_mock_data(output = "pandas", size = 10) -> pd.DataFrame|pl.DataFrame:
    df = pd.DataFrame()
    df = df.assign(
        sample_id = [fake.uuid4() for _ in range(size)],
        lab_id = [fake.uuid4() for _ in range(size)],
        key_plot = [fake.word() for _ in range(size)],
        day_num = [random.randint(10, 2100) for _ in range(size)],
        cases_new_cens_per100k = [random.uniform(0, 11200) for _ in range(size)],
        pcr_target_flowpop_lin = [random.uniform(5, 4e+18) for _ in range(size)],
        sample_collect_date = [fake.date() for _ in range(size)],
        pcr_target_flowpop_log10 = [random.uniform(1.1, 18) for _ in range(size)],
        rec_eff_percent = [random.uniform(0, 100) for _ in range(size)],
        wwtp_id = [random.randint(1, 1000)for _ in range(size)],
        wwtp_jurisdiction = [random.choice(wwtop_opts) for _ in range(size)],
        county_names = [f"{random.randint(0, 99999):05d}" for _ in range(size)],
        stormwater_input = [random.choice(["yes", "no"]) for _ in range(size)],
        influent_equilibrated = [random.choice(["yes", "no"]) for _ in range(size)],
        sample_type = [random.choice(sample_type_opts) for _ in range(size)],
        sample_matrix = [random.choice(matrix_opts) for _ in range(size)],
        sample_location = [random.choice(sample_location_opts) for _ in range(size)],
        sample_location_specify = [random.uniform(2, 724) for _ in range(size)],
        reporting_jurisdiction = [random.choice(reporting_jur_opts) for _ in range(size)],
        capacity_mgd = [random.uniform(0.02, 1440) for _ in range(size)],
        population_served = [random.randint(3000, 4000000) for _ in range(size)],
        industrial_input = [random.uniform(0, 75) for _ in range(size)],
        sewage_travel_time = [random.uniform(0, 72) for _ in range(size)],
        slopes_flowpop_5m = [random.uniform(-1.3, 1.3) for _ in range(size)],
        pvals_flowpop_5m = [random.uniform(0, 1) for _ in range(size)],
        pdc_flowpop_5m = [random.uniform(-95, 1600) for _ in range(size)],
        predsuprexc_flowpop_5m = [random.uniform(-19, 129) for _ in range(size)],
        alert_flowpop_5m = [random.choice(['yes', 'no']) for _ in range(size)],
        slopes_flowpop_3m = [random.uniform(-2, 1.8) for _ in range(size)],
        pvals_flowpop_3m = [random.uniform(0, 1) for _ in range(size)],
        pdc_flowpop_3m = [random.uniform(-95, 1600) for _ in range(size)],
        predsuprexc_flowpop_3m = [random.uniform(-19, 129) for _ in range(size)],
        alert_flowpop_3m = [random.choice(['yes', 'no']) for _ in range(size)],
        trend_flowpop_5m3m_p05 = [random.uniform(-1, 1) for _ in range(size)],
        trend_flowpop_5m3m_p05_prev = [random.choice(trend_flowpop_opts) for _ in range(size)],
        slopes_mic_5m = [random.uniform(-1.3, 1.3) for _ in range(size)],
        pvals_mic_5m = [random.uniform(0, 1) for _ in range(size)],
        pdc_mic_5m = [random.uniform(-95, 1600) for _ in range(size)],
        predsuprexc_mic_5m = [random.uniform(-19, 129) for _ in range(size)],
        alert_mic_5m = [random.choice(['yes', 'no']) for _ in range(size)],
        slopes_mic_3m = [random.uniform(-2, 1.8) for _ in range(size)],
        pvals_mic_3m = [random.uniform(0, 1) for _ in range(size)],
        pdc_mic_3m = [random.uniform(-95, 1600) for _ in range(size)],
        predsuprexc_mic_3m = [random.uniform(-19, 129) for _ in range(size)],
        alert_mic_3m = [random.choice(['yes', 'no']) for _ in range(size)],
        trend_mic_5m3m_p05 = [random.uniform(-1, 1) for _ in range(size)],
        trend_mic_5m3m_p05_prev = [random.choice(trend_flowpop_opts) for _ in range(size)],
        slopes_flowpop_15d = [random.uniform(-1.3, 1.3) for _ in range(size)],
        pvals_flowpop_15d = [random.uniform(0, 1) for _ in range(size)],
        pdc_flowpop_15d = [random.uniform(-95, 1600) for _ in range(size)],
        predsuprexc_flowpop_15d = [random.uniform(-19, 129) for _ in range(size)],
        alert_flowpop_15d = [random.choice(['yes', 'no']) for _ in range(size)],
        slopes_flowpop_8d = [random.uniform(-1.3, 1.3) for _ in range(size)],
        pvals_flowpop_8d = [random.uniform(0, 1) for _ in range(size)],
        pdc_flowpop_8d = [random.uniform(-95, 1600) for _ in range(size)],
        predsuprexc_flowpop_8d = [random.uniform(-19, 129) for _ in range(size)],
        alert_flowpop_8d = [random.choice(['yes', 'no']) for _ in range(size)],
        trend_flowpop_15d8d_p05 = [random.uniform(-1, 1) for _ in range(size)],
        trend_flowpop_15d8d_p05_prev = [random.choice(trend_flowpop_opts) for _ in range(size)],
        slopes_mic_15d = [random.uniform(-1.3, 1.3) for _ in range(size)],
        pvals_mic_15d = [random.uniform(0, 1) for _ in range(size)],
        pdc_mic_15d = [random.uniform(-95, 1600) for _ in range(size)],
        predsuprexc_mic_15d = [random.uniform(-19, 129) for _ in range(size)],
        alert_mic_15d = [random.choice(['yes', 'no']) for _ in range(size)],
        slopes_mic_8d = [random.uniform(-1.3, 1.3) for _ in range(size)],
        pvals_mic_8d = [random.uniform(0, 1) for _ in range(size)],
        pdc_mic_8d = [random.uniform(-95, 1600) for _ in range(size)],
        predsuprexc_mic_8d = [random.uniform(-19, 129) for _ in range(size)],
        alert_mic_8d = [random.choice(['yes', 'no']) for _ in range(size)],
        trend_mic_15d8d_p05 = [random.uniform(-1, 1) for _ in range(size)],
        trend_mic_15d8d_p05_prev = [random.choice(trend_flowpop_opts) for _ in range(size)],
        cases_new_cens = [random.randint(0, 100) for _ in range(size)],
        pcr_target_mic_lin_roll7 = [random.uniform(0, 1) for _ in range(size)],
        pcr_target_flowpop_lin_roll7 = [random.uniform(0, 1) for _ in range(size)],
        pcr_target_flowpop_lin_spline = [random.uniform(0, 1) for _ in range(size)],
        pcr_target_mic_lin_spline = [random.uniform(0, 1) for _ in range(size)],
        cases_new_cens_per100k_spline = [random.uniform(0, 1) for _ in range(size)],
        pcr_target_detect = [random.choice(['yes', 'no']) for _ in range(size)],
        hum_frac_mic_conc = [random.uniform(0, 1) for _ in range(size)],
        hum_frac_mic_unit = [random.choice(['mg/L', 'µg/L']) for _ in range(size)],
        hum_frac_chem_conc = [random.uniform(0, 1) for _ in range(size)],
        hum_frac_chem_unit = [random.choice(['mg/L', 'µg/L']) for _ in range(size)],
        other_norm_conc = [random.uniform(0, 1) for _ in range(size)],
        other_norm_unit = [random.choice(['mg/L', 'µg/L']) for _ in range(size)],
        lod_sewage = [random.uniform(0, 1) for _ in range(size)],
        pcr_target = [random.choice(['yes', 'no']) for _ in range(size)],
        pcr_gene_target_agg = [random.choice(['yes', 'no']) for _ in range(size)],
        inhibition_detect = [random.choice(['yes', 'no']) for _ in range(size)],
        inhibition_adjust = [random.choice(['yes', 'no']) for _ in range(size)],
        hum_frac_target_chem = [random.uniform(0, 1) for _ in range(size)],
        other_norm_name = [random.choice(['name1', 'name2']) for _ in range(size)],
        hum_frac_target_mic = [random.uniform(0, 1) for _ in range(size)],
        flow_rate = [random.uniform(0, 1) for _ in range(size)],
        pcr_target_avg_conc = [random.uniform(0, 1) for _ in range(size)],
        pcr_target_below_lod = [random.choice(['yes', 'no']) for _ in range(size)],
        solids_separation = [random.choice(['yes', 'no']) for _ in range(size)],
        concentration_method = [random.choice(['method1', 'method2']) for _ in range(size)],
        extraction_method = [random.choice(['method1', 'method2']) for _ in range(size)],
        rec_eff_target_name = [random.choice(['name1', 'name2']) for _ in range(size)],
        rec_eff_spike_matrix = [random.choice(['matrix1', 'matrix2']) for _ in range(size)],
        pasteurized = [random.choice(['yes', 'no']) for _ in range(size)],
        pcr_type = [random.choice(['type1', 'type2']) for _ in range(size)],
        quant_stan_type = [random.choice(['type1', 'type2']) for _ in range(size)],
        pcr_target_units = [random.choice(['unit1', 'unit2']) for _ in range(size)],
        quality_flag = [random.choice(['flag1', 'flag2']) for _ in range(size)],
        collection_storage_temp = [random.uniform(0, 1) for _ in range(size)],
        collection_storage_time = [random.uniform(0, 1) for _ in range(size)],
        pre_conc_storage_temp = [random.uniform(0, 1) for _ in range(size)],
        pre_conc_storage_time = [random.uniform(0, 1) for _ in range(size)],
        pre_ext_storage_temp = [random.uniform(0, 1) for _ in range(size)],
        pre_ext_storage_time = [random.uniform(0, 1) for _ in range(size)],
        sample_collect_time = [random.uniform(0, 1) for _ in range(size)],
        time_zone = [random.choice(['UTC', 'PST', 'EST']) for _ in range(size)],
        collection_water_temp = [random.uniform(0, 1) for _ in range(size)],
        tot_conc_vol = [random.uniform(0, 1) for _ in range(size)],
        ext_blank = [random.uniform(0, 1) for _ in range(size)],
        num_no_target_control = [random.randint(0, 10) for _ in range(size)],
        tss = [random.uniform(0, 1) for _ in range(size)],
        ph = [random.uniform(0, 14) for _ in range(size)],
        composite_freq = [random.choice(['daily', 'weekly', 'monthly']) for _ in range(size)],
        pcr_target_avg_conc_log10 = [random.uniform(0, 1) for _ in range(size)],
        pcr_target_avg_conc_lin = [random.uniform(0, 1) for _ in range(size)],
        pcr_target_mic_lin = [random.uniform(0, 1) for _ in range(size)],
        pcr_target_mic_log10 = [random.uniform(0, 1) for _ in range(size)],
        rec_eff_spike_conc = [random.uniform(0, 1) for _ in range(size)],
        conductivity = [random.uniform(0, 1) for _ in range(size)],
        equiv_sewage_amt = [random.uniform(0, 1) for _ in range(size)],
        hum_frac_mic_conc_lin = [random.uniform(0, 1) for _ in range(size)],
        ntc_amplify = [random.choice(['yes', 'no']) for _ in range(size)],
        ptc_flowpop_3m = [random.uniform(0, 1) for _ in range(size)],
        ptc_flowpop_5m = [random.uniform(0, 1) for _ in range(size)],
        ptc_flowpop_8d = [random.uniform(0, 1) for _ in range(size)],
        ptc_flowpop_15d = [random.uniform(0, 1) for _ in range(size)],
        ptc_mic_3m = [random.uniform(0, 1) for _ in range(size)],
        ptc_mic_5m = [random.uniform(0, 1) for _ in range(size)],
        ptc_mic_8d = [random.uniform(0, 1) for _ in range(size)],
        ptc_mic_15d = [random.uniform(0, 1) for _ in range(size)],
        perc_flowpop = [random.uniform(0, 1) for _ in range(size)],
        quin_flowpop_bin = [random.choice(['yes', 'no']) for _ in range(size)],
        perc_mic = [random.uniform(0, 1) for _ in range(size)],
        quin_mic_bin = [random.choice(['yes', 'no']) for _ in range(size)],
        major_lab_method = [random.choice(['1', '5']) for _ in range(size)],
        site_id = [random.randint(1, 100) for _ in range(size)],
        jurisdiction_policy_rid = [random.randint(1, 100) for _ in range(size)]
    )
    return df if output == "pandas" or output == "pd" else pl.from_pandas(df)